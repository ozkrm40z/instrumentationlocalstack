version : '3'

networks:
  instrumentationstack:

services:
 loki:
  image: grafana/loki:master
  restart: always
  ports:
   - 3100:3100
  volumes:
   - D:\Sites\DummyNet5\DummyAPI\loki\loki-config.yaml:/etc/config/loki.yaml
  entrypoint:
   - /usr/bin/loki
   - -config.file=/etc/config/loki.yaml
  networks:
   - instrumentationstack

 fluentd:
  image: grafana/fluent-plugin-loki:master
  command:
  - "fluentd"
  - "-v"
  - "-p"
  - "/fluentd/plugins"
  environment:
   LOKI_URL: http://loki:3100
   LOKI_USERNAME:
   LOKI_PASSWORD:
  deploy:
   mode: global
   configs:
    - source: loki_config
   target: /fluentd/etc/loki/loki.conf
   networks:
    - instrumentationstack
   volumes:
    - host_logs:/var/log
    # Needed for journald log ingestion:
    - /etc/machine-id:/etc/machine-id
    - /dev/log:/dev/log
    - /var/run/systemd/journal/:/var/run/systemd/journal/
   logging:
    options:
     tag: infra.monitoring
   depends_on:
    - loki

 prometheus:
  image: prom/prometheus
  environment:
  - COMPOSE_CONVERT_WINDOWS_PATHS=true
  restart: always
  ports:
   - 9090:9090
  volumes:
   - D:\Sites\DummyNet5\DummyAPI\prometheus\prometheus-config.yml:/etc/prometheus/prometheus.yml:ro
  networks:
   - instrumentationstack

 grafana:
  image: grafana/grafana
  environment:
   - GF_SECURITY_ADMIN_PASSWORD=Password
  restart: always
  ports:
   - 3000:3000
  networks:
   - instrumentationstack
  depends_on:
   - prometheus